#%Module -*- tcl -*-
#
# Tensorflow GPU version
#

proc ModulesHelp { } {

    puts stderr "This module adds the Tensorflow 1.14.0 package to your environment."
    puts stderr ""
    puts stderr "This version is built for GPU."

}

module-whatis "Adds Tensorflow 1.14.0 to your environment."

prereq compilers/gnu/4.9.2
prereq cuda/10.0.130/gnu-4.9.2
prereq cudnn/7.4.2.24/cuda-10.0
conflict tensorflow

# Add binary to PATH
#module load python/3.6.3
set python_ver 3.6
set pystr ""

if { [info exists ::env(PYTHON_VERSION_TAG)] } {
   set python_ver $::env(PYTHON_VERSION_TAG)
}

if { $python_ver=="3.6" } {
   module load python/3.6.3
   set root 			/shared/ucl/apps/tensorflow/1.14.0/gpu
   if { [file isdirectory $root] } then {
	prepend-path PYTHONPATH         $root
   }
}

if { $python_ver=="3.7" } {
   prereq python3/3.7.4
   set pystr "-py37"

   if { [ file type /shared/ucl/apps ] == "link" } {
      set           baselink          [ file readlink /shared/ucl/apps ]
      set           base              $baselink/tensorflow/1.14.0/gpu$pystr
   } else {
      set           base              /shared/ucl/apps/tensorflow/1.14.0/gpu$pystr
   }
   set              root              $base

   prepend-path     LD_RUN_PATH       $root/lib
   prepend-path     LD_LIBRARY_PATH   $root/lib

   prepend-path     PATH              $root/bin
   prepend-path     PYTHONPATH        $root/lib/python$python_ver/site-packages

   prepend-path     LD_RUN_PATH       $root/lib64
   prepend-path     LD_LIBRARY_PATH   $root/lib64

   prepend-path     CPATH             $root/include
   prepend-path     INCLUDE_PATH      $root/include

   prepend-path CMAKE_PREFIX_PATH $root/venv

}



